const Test = require('../models/Test.model');

const fetch_past_results = async(req, res)=>{
	let {limit} = req.body;
	limit = Math.min(Number(limit)||5, 10);
	const user_id = req.user._id;
	try{
		const test_results = await Test.find({alcohol_id.toString()==user_id}).limit(limit);
		const overall_score = (test_results.logical_reasoning_score + test_results.voice_score)/2;

		return res.status(200).json({
			success: true,
			test_results: test_results,
			overall_score: overall_score
		});
	}
	catch(err){
		console.log(err);
		return res.status(500).json({
			success: false,
			message: "Couldn't fetch results, try again
		});
	}
}

module.exports = {
	fetch_past_results
}

